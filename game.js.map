{"version":3,"file":"game.js","sources":["js/maze.js","js/image.js","js/misc.js","js/level.js","js/object.js","js/demon.js","js/game.js","js/stage.js","js/player.js"],"sourcesContent":["class Maze{\n\tSPACE = undefined;\n\tWALL = 1;\n\tFOOTPRINT = 2;\n\tgoal = undefined;\n\tfootPrint = new Array();\n\tconstructor(w, h, initfunc){\n\t\tthis.w = w;\n\t\tthis.h = h;\n\t\tthis.data = new Array(this.w * this.h);\n\n\t\t//Init\n\t\tif (undefined != initfunc) {\n\t\t\tinitfunc(this);\n\t\t}\n\t}\n\tget(x, y) {\n\t\treturn this.data[x + y * this.w];\n\t}\n\tset(x, y, element){\n\t\tdelete this.data[x + y * this.w];\n\t\tthis.data[x + y * this.w] = element;\n\t}\n\tgetDir(x0, y0, x1, y1) {\n\t\tvar goal = this.goal;\n\t\tvar dx = x1 - x0;\n\t\tvar dy = y1 - y0;\n\n\t\tif (dx == 0 && dy == 0) {\n\t\t\treturn [];\n\t\t} else if (dx >= 0 && dy < 0) {\n\t\t\tif (dx >= -dy) {\n\t\t\t\treturn ['E', 'N', 'S', 'W'];\n\t\t\t} else {\n\t\t\t\treturn ['N', 'E', 'W', 'S'];\n\t\t\t}\n\t\t} else if (dx < 0 && dy < 0) {\n\t\t\tif (-dx >= -dy) {\n\t\t\t\treturn ['W', 'N', 'S', 'E'];\n\t\t\t} else {\n\t\t\t\treturn ['N', 'W', 'E', 'S'];\n\t\t\t}\n\t\t} else if (dx < 0 && dy >= 0) {\n\t\t\tif (-dx >= dy) {\n\t\t\t\treturn ['W', 'S', 'N', 'E'];\n\t\t\t} else {\n\t\t\t\treturn ['S', 'W', 'E', 'N'];\n\t\t\t}\n\t\t} else if (dx >= 0 && dy >= 0) {\n\t\t\tif (dx >= dy) {\n\t\t\t\treturn ['E', 'S', 'N', 'W'];\n\t\t\t} else {\n\t\t\t\treturn ['S', 'E', 'W', 'N'];\n\t\t\t}\n\t\t}\n\t}\n\treachable(x, y){\n\t\tif (x < 0 || x >= this.w || y < 0 || y >= this.h) {\n\t\t\treturn false;\n\t\t} else if (this.SPACE != this.get(x, y)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\tgetPosByDir(x, y, dir){\n\t\tvar result;\n\t\tswitch (dir) {\n\t\t\tcase 'N':\n\t\t\t\tresult = {x:x, y:y-1};\n\t\t\tbreak;\n\t\t\tcase 'E':\n\t\t\t\tresult = {x:x+1, y:y};\n\t\t\tbreak;\n\t\t\tcase 'W':\n\t\t\t\tresult = {x:x-1, y:y};\n\t\t\tbreak;\n\t\t\tcase 'S':\n\t\t\t\tresult = {x:x, y:y+1};\n\t\t\tbreak;\n\t\t}\n\t\treturn result;\n\t}\n\tnext(){\n\t\tif (0 == this.footPrint.length) {\n\t\t\treturn false;\n\t\t}\n\t\tvar currentPos = this.footPrint[this.footPrint.length - 1];\n\t\tif (currentPos.x == this.goal.x && currentPos.y == this.goal.y) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar dirCandidate = this.getDir(currentPos.x, currentPos.y, this.goal.x, this.goal.y);\n\t\tfor (var i in dirCandidate) {\n\t\t\tvar nextPos = this.getPosByDir(currentPos.x, currentPos.y, dirCandidate[i]);\n\t\t\tif (this.reachable(nextPos.x, nextPos.y)) {\n\t\t\t\tthis.footPrint.push(nextPos);\n\t\t\t\tthis.set(nextPos.x, nextPos.y, this.FOOTPRINT);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t//None of the directions reachable\n\t\tvar posBlock = this.footPrint.pop();\n\t\treturn true;\n\t}\n}\nexport default function(stage, player, destCol, destRow) {\n\tvar result = new Array();\n\tvar maze = new Maze(stage.cols, stage.rows, function(maze){\n\t\tvar col, row;\n\t\tfor (row = 0; row < stage.rows; row++) {\n\t\t\tfor (col = 0; col < stage.cols; col++) {\n\t\t\t\tlet object = stage.getObject(col, row);\n\t\t\t\tif (undefined == object) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t//Trigger blackArea()\n\t\t\t\tif (undefined != object.blackArea) {\n\t\t\t\t\tvar posList = object.blackArea(stage, col, row);\n\t\t\t\t\tfor (var i = 0; i < posList.length; i++) {\n\t\t\t\t\t\tmaze.set(posList[i].col, posList[i].row, maze.WALL);\n\t\t\t\t\t}\n\t\t\t\t} else if (true != object.pick) { //Non-pickable objects\n\t\t\t\t\tmaze.set(col, row, maze.WALL);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmaze.goal = {x:destCol, y:destRow};\n\t\tmaze.footPrint = [{x:player.Moveable.col, y:player.Moveable.row}];\n\t});\n\n\t//Solve \n\twhile(maze.next());\n\n\t//Process the result\n\tvar resultRaw = maze.footPrint;\n\tif (0 == maze.footPrint.length) {\n\t\tresult = undefined;\n\t} else {\n\t\tfor (var i in maze.footPrint) {\n\t\t\tresult.push({col:resultRaw[i].x, row:resultRaw[i].y});\n\t\t}\n\t}\n\treturn result;\n}\n\n","export const IMAGE_W = 36;\nexport const IMAGE_H = 36;\nexport function drawImage(__image, ctx, col, row) {\n\tctx.drawImage(__image.img,\n\t\t(__image.x * IMAGE_W), (__image.y * IMAGE_H), IMAGE_W, IMAGE_H,\n\t\tMath.floor(col * IMAGE_W), Math.floor(row * IMAGE_H), IMAGE_W, IMAGE_H);\n}\n\nvar imageObj = new Array();\nimageObj[0] = new Image();\nimageObj[0].src = 'image/1.gif';\nimageObj[1] = new Image();\nimageObj[1].src = 'image/2.gif';\nimageObj[2] = new Image();\nimageObj[2].src = 'image/3.gif';\nimageObj[3] = new Image();\nimageObj[3].src = 'image/4.gif';\n\nexport const image={\n\tundefined:{img:imageObj[0], x:1, y:11},\n\t'Apple':{img:imageObj[1], x:1, y:0},\n\t'AppleRotten':[\n\t\t{img:imageObj[0], x:1, y:0},\n\t\t{img:imageObj[0], x:1, y:1},\n\t],\n\t'Ball':{img:imageObj[1], x:1, y:1},\n\t'Bomb':{\n\t\tnormal: {img:imageObj[0], x:1, y:2},\n\t\tticking: [\n\t\t\t{img:imageObj[0], x:1, y:3},\n\t\t\t{img:imageObj[0], x:1, y:4},\n\t\t],\n\t\tdetonate: {img:imageObj[1], x:0, y:12},\n\t},\n\t'Crystal':[\n\t\t{img:imageObj[0], x:1, y:5},\n\t\t{img:imageObj[0], x:1, y:6},\n\t\t{img:imageObj[0], x:1, y:7},\n\t],\n\t'Demon':{\n\t\t'N':[\n\t\t\t{img:imageObj[0], x:0, y:7},\n\t\t\t{img:imageObj[0], x:0, y:6},\n\t\t\t{img:imageObj[0], x:0, y:8},\n\t\t],\n\t\t'E':[\n\t\t\t{img:imageObj[0], x:0, y:0},\n\t\t\t{img:imageObj[0], x:0, y:1},\n\t\t\t{img:imageObj[0], x:0, y:2},\n\t\t],\n\t\t'W':[\n\t\t\t{img:imageObj[0], x:0, y:9},\n\t\t\t{img:imageObj[0], x:0, y:10},\n\t\t\t{img:imageObj[0], x:0, y:11},\n\t\t],\n\t\t'S':[\n\t\t\t{img:imageObj[0], x:0, y:4},\n\t\t\t{img:imageObj[0], x:0, y:3},\n\t\t\t{img:imageObj[0], x:0, y:5},\n\t\t],\n\t},\n\t'Destroyed':{img:imageObj[1], x:0, y:11},\n\t'Door':{img:imageObj[1], x:1, y:3},\n\t'Egg':{img:imageObj[1], x:1, y:4},\n\t'Flower':[\n\t\t{img:imageObj[1], x:1, y:6},\n\t\t{img:imageObj[1], x:1, y:5},\n\t],\n\t'Key':{img:imageObj[1], x:1, y:7},\n\t'LaserGun':{img:imageObj[1], x:1, y:8},\n\t'Mushroom':[\n\t\t{img:imageObj[1], x:1, y:9},\n\t\t{img:imageObj[1], x:1, y:10},\n\t],\n\t'Player':{\n\t\t'N':[\n\t\t\t{img:imageObj[1], x:2, y:11},\n\t\t\t{img:imageObj[1], x:2, y:10},\n\t\t\t{img:imageObj[1], x:2, y:12},\n\t\t],\n\t\t'E':[\n\t\t\t{img:imageObj[1], x:2, y:5},\n\t\t\t{img:imageObj[1], x:2, y:6},\n\t\t\t{img:imageObj[1], x:2, y:7},\n\t\t],\n\t\t'W':[\n\t\t\t{img:imageObj[1], x:3, y:12},\n\t\t\t{img:imageObj[1], x:3, y:13},\n\t\t\t{img:imageObj[1], x:3, y:14},\n\t\t],\n\t\t'S':[\n\t\t\t{img:imageObj[1], x:2, y:0},\n\t\t\t{img:imageObj[1], x:2, y:8},\n\t\t\t{img:imageObj[1], x:2, y:9},\n\t\t],\n\t\t'sleepy':[\n\t\t\t{img:imageObj[1], x:2, y:0},\n\t\t\t{img:imageObj[1], x:2, y:1},\n\t\t\t{img:imageObj[1], x:2, y:2},\n\t\t\t{img:imageObj[1], x:2, y:3},\n\t\t\t{img:imageObj[1], x:2, y:4},\n\t\t],\n\t\t'poisoned': [\n\t\t\t{img:imageObj[1], x:3, y:0},\n\t\t\t{img:imageObj[1], x:3, y:1},\n\t\t\t{img:imageObj[1], x:3, y:2},\n\t\t\t{img:imageObj[1], x:3, y:3},\n\t\t\t{img:imageObj[1], x:3, y:4},\n\t\t\t{img:imageObj[1], x:3, y:5},\n\t\t\t{img:imageObj[1], x:3, y:6},\n\t\t\t{img:imageObj[1], x:3, y:7},\n\t\t\t{img:imageObj[1], x:3, y:8},\n\t\t\t{img:imageObj[1], x:3, y:9},\n\t\t\t{img:imageObj[1], x:3, y:10},\n\t\t\t{img:imageObj[1], x:3, y:11},\n\t\t\t{img:imageObj[1], x:2, y:0},\n\t\t],\n\t},\n\t'PlayerGirl':{\n\t\t'N':[\n\t\t\t{img:imageObj[3], x:0, y:11},\n\t\t\t{img:imageObj[3], x:0, y:10},\n\t\t\t{img:imageObj[3], x:0, y:12},\n\t\t],\n\t\t'E':[\n\t\t\t{img:imageObj[3], x:0, y:5},\n\t\t\t{img:imageObj[3], x:0, y:6},\n\t\t\t{img:imageObj[3], x:0, y:7},\n\t\t],\n\t\t'W':[\n\t\t\t{img:imageObj[3], x:1, y:12},\n\t\t\t{img:imageObj[3], x:1, y:13},\n\t\t\t{img:imageObj[3], x:1, y:14},\n\t\t],\n\t\t'S':[\n\t\t\t{img:imageObj[3], x:0, y:0},\n\t\t\t{img:imageObj[3], x:0, y:8},\n\t\t\t{img:imageObj[3], x:0, y:9},\n\t\t],\n\t\t'sleepy':[\n\t\t\t{img:imageObj[3], x:0, y:0},\n\t\t\t{img:imageObj[3], x:0, y:1},\n\t\t\t{img:imageObj[3], x:0, y:2},\n\t\t\t{img:imageObj[3], x:0, y:3},\n\t\t\t{img:imageObj[3], x:0, y:4},\n\t\t],\n\t\t'poisoned': [\n\t\t\t{img:imageObj[3], x:1, y:0},\n\t\t\t{img:imageObj[3], x:1, y:1},\n\t\t\t{img:imageObj[3], x:1, y:2},\n\t\t\t{img:imageObj[3], x:1, y:3},\n\t\t\t{img:imageObj[3], x:1, y:4},\n\t\t\t{img:imageObj[3], x:1, y:5},\n\t\t\t{img:imageObj[3], x:1, y:6},\n\t\t\t{img:imageObj[3], x:1, y:7},\n\t\t\t{img:imageObj[3], x:1, y:8},\n\t\t\t{img:imageObj[3], x:1, y:9},\n\t\t\t{img:imageObj[3], x:1, y:10},\n\t\t\t{img:imageObj[3], x:1, y:11},\n\t\t\t{img:imageObj[3], x:0, y:0},\n\t\t],\n\t},\n\t'PFlower':{\n\t\tdigest: [\n\t\t\t{img:imageObj[0], x:2, y:0},\n\t\t\t{img:imageObj[0], x:2, y:7},\n\t\t\t{img:imageObj[0], x:2, y:6},\n\t\t\t{img:imageObj[0], x:2, y:5},\n\t\t\t{img:imageObj[0], x:2, y:4},\n\t\t],\n\t\topen: [\n\t\t\t{img:imageObj[0], x:2, y:3},\n\t\t\t{img:imageObj[0], x:2, y:2},\n\t\t\t{img:imageObj[0], x:2, y:1},\n\t\t\t{img:imageObj[0], x:2, y:0},\n\t\t],\n\t\tplayer: [\n\t\t\t{img:imageObj[0], x:1, y:8},\n\t\t\t{img:imageObj[0], x:1, y:9},\n\t\t\t{img:imageObj[0], x:1, y:10},\n\t\t],\n\t\tgrab: {\n\t\t\t'N': {img:imageObj[2], x:0, y:1},\n\t\t\t'E': {img:imageObj[2], x:0, y:3},\n\t\t\t'W': {img:imageObj[2], x:1, y:2},\n\t\t\t'S': {img:imageObj[2], x:1, y:0},\n\t\t},\n\t},\n\t'Pill':{img:imageObj[1], x:1, y:11},\n\t'SpacerLaser':[\n\t\t{img:imageObj[0], x:2, y:8},\n\t\t{img:imageObj[0], x:2, y:9},\n\t],\n\t'SpacerPFlower':{\n\t\tgrabApple: {\n\t\t\t'N': {img:imageObj[2], x:0, y:0},\n\t\t\t'E': {img:imageObj[2], x:1, y:3},\n\t\t\t'W': {img:imageObj[2], x:0, y:2},\n\t\t\t'S': {img:imageObj[2], x:1, y:1},\n\t\t},\n\t\tgrabPlayer: {\n\t\t\t'N': {img:imageObj[2], x:2, y:0},\n\t\t\t'E': {img:imageObj[2], x:3, y:3},\n\t\t\t'W': {img:imageObj[2], x:2, y:2},\n\t\t\t'S': {img:imageObj[2], x:3, y:1},\n\t\t},\n\t},\n\t'Treasure':{img:imageObj[1], x:0, y:10},\n\t'Wall':[\n\t\t{img:imageObj[1], x:0, y:0},\n\t\t{img:imageObj[1], x:0, y:1},\n\t\t{img:imageObj[1], x:0, y:2},\n\t\t{img:imageObj[1], x:0, y:3},\n\t\t{img:imageObj[1], x:0, y:4},\n\t\t{img:imageObj[1], x:0, y:5},\n\t\t{img:imageObj[1], x:0, y:6},\n\t\t{img:imageObj[1], x:0, y:7},\n\t\t{img:imageObj[1], x:0, y:8},\n\t\t{img:imageObj[1], x:0, y:9},\n\t\t{img:imageObj[1], x:1, y:2},\n\t\t{img:imageObj[1], x:1, y:12},\n\t]\n};\n","import {image,drawImage} from './image';\n\nexport const DIR_NORTH='N';\nexport const DIR_EAST='E';\nexport const DIR_WEST='W';\nexport const DIR_SOUTH='S';\n\nexport const DIR_LEFT='L';\nexport const DIR_RIGHT='R';\nexport const DIR_BACK='B';\n\nexport function switchDir(dir, sw) {\n\tvar expr;\n\tswitch (dir) {\n\t\tcase DIR_NORTH:\n\t\t\texpr = {'L':DIR_WEST, 'R':DIR_EAST, 'B':DIR_SOUTH};\n\t\tbreak;\n\t\tcase DIR_EAST:\n\t\t\texpr = {'L':DIR_NORTH, 'R':DIR_SOUTH, 'B':DIR_WEST};\n\t\tbreak;\n\t\tcase DIR_WEST:\n\t\t\texpr = {'L':DIR_SOUTH, 'R':DIR_NORTH, 'B':DIR_EAST};\n\t\tbreak;\n\t\tcase DIR_SOUTH:\n\t\t\texpr = {'L':DIR_EAST, 'R':DIR_WEST, 'B':DIR_NORTH};\n\t\tbreak;\n\t\tdefault:\n\t\t\tthrow TypeError;\n\t\tbreak;\n\t}\n\tif (undefined == expr[sw]) {\n\t\tthrow TypeError;\n\t}\n\treturn expr[sw];\n}\nexport function getDir(col0, row0, col1, row1){\n\tif (row0 == row1 && col0 == col1) {\n\t\treturn undefined;\n\t}\n\tif (row0 == row1) {\n\t\treturn (col0 < col1 ? DIR_EAST : DIR_WEST);\n\t} else if (col0 == col1) {\n\t\treturn (row0 < row1 ? DIR_SOUTH : DIR_NORTH);\n\t} else {\n\t\treturn undefined;\n\t}\n}\nexport class Moveable{\n\tstepMax = 8;\n\tcolPrev = undefined;\n\trowPrev = undefined;\n\tstep = 0;\n\n\tconstructor(col, row, dir){\n\t\tthis.col = col;\n\t\tthis.row = row;\n\t\tthis.dir = dir;\n\t}\n\n\tisMoving(){\n\t\tif (this.step > 0) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tmove(dir){\n\t\tif (this.isMoving()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.dir = dir;\n\t\tthis.step = this.stepMax;\n\t\tthis.colPrev = this.col;\n\t\tthis.rowPrev = this.row;\n\t\tswitch(dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\t\tthis.row--;\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tthis.col++;\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tthis.col--;\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tthis.row++;\n\t\t\tbreak;\n\t\t}\n\t\treturn true;\n\t}\n\tonTick(){\n\t\tvar result = undefined;\n\t\tif (this.isMoving()) {\n\t\t\tthis.step--;\n\t\t\tif (!this.isMoving()) {\n\t\t\t\tresult = {colPrev: this.colPrev, rowPrev: this.rowPrev};\n\t\t\t\tthis.colPrev = this.rowPrev = undefined;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tonDraw(img, ctx){\n\t\tswitch (this.dir){\n\t\t\tcase DIR_NORTH:\n\t\t\t\tdrawImage(img, ctx, this.col, this.row + this.step / this.stepMax);\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tdrawImage(img, ctx, this.col - this.step / this.stepMax, this.row);\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tdrawImage(img, ctx, this.col + this.step / this.stepMax, this.row);\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tdrawImage(img, ctx, this.col, this.row - this.step / this.stepMax);\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\n//Handle sound via WebAudioAPI\nconst audioContext=new AudioContext();\nasync function loadSound(fileList){\n\tlet taskList=[], result={};\n\tfor(let fileName of fileList){\n\t\t(function(fileName){\n\t\t\ttaskList.push({\n\t\t\t\tfileName,\n\t\t\t\ttask:new Promise(async(resolve)=>{\n\t\t\t\t\tlet resp=await fetch(`./audio/${fileName}.wav`);\n\t\t\t\t\tif(!resp.ok){\n\t\t\t\t\t\tconsole.error(`Failed to load ${fileName}.wav: ${resp.statusText}`);\n\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\taudioContext.decodeAudioData(await resp.arrayBuffer(),resolve);\n\t\t\t\t})\n\t\t\t});\n\t\t})(fileName);\n\t}\n\tlet respAll=await Promise.all(taskList.map(item=>item.task));\n\ttaskList.forEach((task,idx)=>{\n\t\tresult[task.fileName]=respAll[idx] || null;\n\t});\n\treturn result;\n}\nlet audioTable={\n\tbitten:null,\n\tcrystal:null,\n\tdetonate:null,\n\tgrab:null,\n\tlasershot:null,\n\tpick:null,\n\tpoisoned:null,\n\tstep:null\n};\nloadSound(Object.keys(audioTable)).then((data)=>{\n\taudioTable=data;\n});\nexport function playAudio(audioFile) {\n\tif(!document.querySelector('input#enableSound').checked || !audioTable[audioFile]){\n\t\treturn;\n\t}\n\tlet source = audioContext.createBufferSource();\n    source.buffer = audioTable[audioFile];\n    source.loop = false;\n    source.connect(audioContext.destination);\n\tsource.start();\n}\n\n","import mazeSolver from './maze';\nimport { getDir } from './misc';\nimport {IMAGE_W, IMAGE_H} from './image';\n\nfunction getDirFromRoute(player, playerRoute) {\n\tvar nextDir = undefined;\n\n\t//Process playerRoute\n\twhile (playerRoute.length > 0\n\t\t&& player.Moveable.col == playerRoute[0].col\n\t\t&& player.Moveable.row == playerRoute[0].row) {\n\t\tplayerRoute.splice(0, 1);\n\t}\n\n\t//Get direction from playerRoute\n\tif (playerRoute.length > 0) {\n\t\tvar dir = getDir(player.Moveable.col, player.Moveable.row,\n\t\t\tplayerRoute[0].col, playerRoute[0].row);\n\t\tif (undefined != dir) {\n\t\t\tnextDir = dir;\n\t\t} else {\n\t\t\tvar solved = mazeSolver(player.stage, player,\n\t\t\t\tplayerRoute[0].col, playerRoute[0].row);\n\t\t\tif (undefined != solved) {\n\t\t\t\tlet len = solved.length\n\t\t\t\tfor (var i = len - 1; i >= 0; i--) {\n\t\t\t\t\tplayerRoute.splice(0, 0, solved[i]);\n\t\t\t\t}\n\t\t\t\tsolved=[];\n\t\t\t\tnextDir = getDir(player.Moveable.col, player.Moveable.row, playerRoute[0].col, playerRoute[0].row);\n\t\t\t}\n\t\t}\n\t}\n\treturn nextDir;\n}\nexport default class Level{\n\tscore = 0;\n\tspeed = 100;\n\tpaused = false;\n\tstopped = false;\n\tdirKeyPressed = [undefined, undefined];\n\tnextDir = [undefined, undefined];\n\tplayerRoute = [new Array(), new Array()];\n\tplayerRouteInUse = 0;\n\tconstructor(stage, ctx){\n\t\tthis.stage=stage;\n\t\tthis.ctx=ctx;\n\t\tdocument.addEventListener('keydown',this.keydownHandler);\n\t\tdocument.addEventListener('keyup',this.keyupHandler);\n\t\tdocument.querySelector('canvas#stage').addEventListener('mousedown',this.mousedownHandler);\n\t\t//Play this level\n\t\tsetTimeout(this.timeoutFunc, this.speed);\n\t}\n\tonFinish(func){\n\t\tthis._onFinish=func;\n\t}\n\tstop(){\n\t\tthis.stopped = true;\n\t\tdocument.removeEventListener('keydown',this.keydownHandler);\n\t\tdocument.removeEventListener('keyup',this.keyupHandler);\n\t\tdocument.querySelector('canvas#stage').removeEventListener('mousedown',this.mousedownHandler);\n\t}\n\tcallOnFinish(score){\n\t\tdocument.removeEventListener('keydown',this.keydownHandler);\n\t\tdocument.removeEventListener('keyup',this.keyupHandler);\n\t\tdocument.querySelector('canvas#stage').removeEventListener('mousedown',this.mousedownHandler);\n\t\tif(this._onFinish){\n\t\t\tthis._onFinish(score);\n\t\t}\n\t}\n\ttimeoutFunc=()=>{\n\t\tif (this.stopped) {\n\t\t\treturn;\n\t\t}\n\t\ttry{\n\t\t\tif (!this.paused) {\n\t\t\t\tvar player = this.stage.player;\n\n\t\t\t\t//Decide which direction to go next\n\t\t\t\tfor (var i in player) {\n\t\t\t\t\tif (!player[i] || player[i].Moveable.isMoving()) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (undefined != this.dirKeyPressed[i]) {\n\t\t\t\t\t\tplayer[i].move(this.dirKeyPressed[i]);\n\t\t\t\t\t\tthis.playerRoute[i]=[];\n\t\t\t\t\t} else if (undefined != this.nextDir[i]) {\n\t\t\t\t\t\tif (player[i].Moveable.dir != this.nextDir[i]) {\n\t\t\t\t\t\t\tplayer[i].move(this.nextDir[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.playerRoute[i]=[];\n\t\t\t\t\t\tthis.nextDir[i] = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar dir = getDirFromRoute(player[i], this.playerRoute[i]);\n\t\t\t\t\t\tif (undefined != dir) {\n\t\t\t\t\t\t\tplayer[i].move(dir);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//Power the whole game\n\t\t\t\tthis.stage.tick(this.ctx);\n\t\t\t\tthis.stage.draw(this.ctx);\n\n\t\t\t\t//Display and misceallanous things\n\t\t\t\tdocument.querySelector('div#paused').style.display='none';\n\t\t\t\tdocument.querySelector('span#score').innerHTML=this.stage.score;\n\t\t\t} else {\n\t\t\t\tdocument.querySelector('div#paused').style.display=null;\n\t\t\t}\n\n\t\t\t//Level finished or continue\n\t\t\tif (this.stage.finished) {\n\t\t\t\tthis.score = this.stage.score;\n\t\t\t\tthis.stage.reset();\n\t\t\t\tthis.callOnFinish(this.score);\n\t\t\t} else {\n\t\t\t\tsetTimeout(this.timeoutFunc, this.speed);\n\t\t\t}\n\t\t}catch(e){\n\t\t\tconsole.error(e);\n\t\t\tsetTimeout(this.timeoutFunc, this.speed);\n\t\t}\n\t}\n\tkeydownHandler=(event)=>{\n\t\tif (!this.paused) {\n\t\t\tlet nextDir=this.nextDir, dirKeyPressed=this.dirKeyPressed;\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 37:\t//Left\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_WEST;\n\t\t\t\tbreak;\n\t\t\t\tcase 38:\t//Up\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_NORTH;\n\t\t\t\tbreak;\n\t\t\t\tcase 39:\t//Right\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_EAST;\n\t\t\t\tbreak;\n\t\t\t\tcase 40:\t//Down\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_SOUTH;\n\t\t\t\tbreak;\n\t\t\t\tcase 65:\t//A\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_WEST;\n\t\t\t\tbreak;\n\t\t\t\tcase 87:   //W\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_NORTH;\n\t\t\t\tbreak;\n\t\t\t\tcase 68:   //D\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_EAST;\n\t\t\t\tbreak;\n\t\t\t\tcase 83:   //S\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_SOUTH;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tswitch (event.keyCode) {\n\t\t\tcase 48:\t//9\n\t\t\t\tthis.playerRouteInUse = 0;\n\t\t\tbreak;\n\t\t\tcase 57:\t//0\n\t\t\t\tthis.playerRouteInUse = 1;\n\t\t\tbreak;\n\t\t\tcase 80:\t//P: Pause\n\t\t\t\tthis.paused = !this.paused;\n\t\t\tbreak;\n\t\t\tcase 82:\t//R: Restart\n\t\t\t\tfor (var i in this.nextDir) {\n\t\t\t\t\tthis.nextDir[i] = undefined;\n\t\t\t\t}\n\t\t\t\tfor (var i in this.dirKeyPressed) {\n\t\t\t\t\tthis.dirKeyPressed[i] = undefined;\n\t\t\t\t}\n\t\t\t\tfor (var i in this.playerRoute) {\n\t\t\t\t\tthis.playerRoute[i]=[];\n\t\t\t\t}\n\t\t\t\tthis.stage.reset();\n\t\t\t\tthis.paused = false;\n\t\t\tbreak;\n\t\t\tcase 32:\t//Space: speed up the game\n\t\t\t\tthis.speed = 20;\n\t\t\tbreak;\n\t\t}\n\t}\n\tkeyupHandler=(event)=>{\n\t\tif (!this.paused) {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 37:\t//Left\n\t\t\t\tcase 38:\t//Up\n\t\t\t\tcase 39:\t//Right\n\t\t\t\tcase 40:\t//Down\n\t\t\t\t\tthis.dirKeyPressed[0] = undefined;\n\t\t\t\tbreak;\n\t\t\t\tcase 65:\t//A\n\t\t\t\tcase 87:\t//W\n\t\t\t\tcase 68:\t//D\n\t\t\t\tcase 83:\t//S\n\t\t\t\t\tthis.dirKeyPressed[1] = undefined;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tswitch (event.keyCode) {\n\t\t\tcase 32:\n\t\t\t\tthis.speed = 100;\n\t\t\tbreak;\n\t\t}\n\t}\n\tmousedownHandler=(e)=>{\n\t\tif (this.paused) {\n\t\t\treturn;\n\t\t}\n\t\tlet xpos = e.offsetX;\n\t\tlet ypos = e.offsetY;\n\t\tlet col = Math.floor(xpos/IMAGE_W);\n\t\tlet row = Math.floor(ypos/IMAGE_H);\n\t\tif (e.shiftKey) {\n\t\t\tthis.playerRoute[this.playerRouteInUse].push({col:col, row:row});\n\t\t} else {\n\t\t\tthis.playerRoute[this.playerRouteInUse] = [{col:col, row:row}];\n\t\t}\n\t}\n}\n","import { playAudio } from \"./misc\";\nimport {image,drawImage} from './image';\n\nexport class Apple{\n\ttype='Apple';\n\tpush=true;\n\teat=true;\n\tdestroy=true;\n\tonTick(stage, col, row){\n\t\tif (this.leaving) {\n\t\t\tthis.destroy = false;\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class AppleRotten{\n\ttype='AppleRotten';\n\tpush=true;\n\teat=true;\n\tdestroy=true;\n\ttimer = 1;\n\timg_index = 0;\n\tonDraw(ctx, col, row){\n\t\tthis.timer++;\n\t\tif (0 == (this.timer % 2)){\n\t\t\tthis.img_index = (0 == this.img_index ? 1 : 0);\n\t\t}\n\t\tdrawImage(image[this.type][this.img_index], ctx, col, row);\n\t}\n}\nexport class Ball{\n\ttype='Ball';\n\tpush = true;\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class Bomb{\n\ttype = 'Bomb';\n\tpush = true;\n\ttimeout = -1;\n\tdetonated = false;\n\tdoActivate() {\n\t\tif (this.timeout < 0) {\n\t\t\tthis.timeout = 160;\n\t\t}\n\t}\n\tdoDetonate(stage, col, row) {\n\t\tthis.push = undefined;\n\t\tthis.detonated = true;\n\t\tvar neighbour = stage.getNeighbour(col, row);\n\t\tvar len = neighbour.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar ncol = neighbour[i].col;\n\t\t\tvar nrow = neighbour[i].row;\n\t\t\tvar object = stage.getObject(ncol, nrow);\n\t\t\tif (undefined != object) {\n\t\t\t\tif (object.destroy) {\n\t\t\t\t\tstage.destroyObject(ncol, nrow);\n\t\t\t\t} else if (object.type == this.type) {\n\t\t\t\t\tobject.doActivate();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tneighbour.splice(0, neighbour.length);\n\t\t//delete neighbour;\n\n\t\tplayAudio('detonate');\n\t}\n\tonTick(stage, col, row) {\n\t\tvar moving = false;\n\t\tif (col < 0 || row < 0) {\n\t\t\tmoving = true;\n\t\t}\n\n\t\tif (moving && this.timeout < 0) {\n\t\t\tthis.doActivate();\n\t\t} else if (this.timeout > 0) {\n\t\t\tthis.timeout --;\n\t\t}\n\n\t\tif (0 == this.timeout) {\n\t\t\tif (this.detonated) {\n\t\t\t\tstage.setObject(col, row, undefined);\n\t\t\t} else if (!moving){\n\t\t\t\tthis.doDetonate(stage, col, row);\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tif (this.timeout < 0) {\n\t\t\tdrawImage(image[this.type]['normal'], ctx, col, row);\n\t\t} else if (this.detonated) {\n\t\t\tdrawImage(image[this.type]['detonate'], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type]['ticking'][this.timeout % 2], ctx, col, row);\n\t\t}\n\t}\n}\nexport class Crystal{\n\ttype = 'Crystal';\n\tpush = true;\n\ttriggered = -1;\n\tTRIGGER = 35;\n\ttrigger(){\n\t\tif (-1 == this.triggered) {\n\t\t\tthis.triggered = this.TRIGGER;\n\t\t\tthis.push = undefined;\n\t\t}\n\t}\n\tonTick(stage, col, row){\n\t\tif (0 == this.triggered) {\n\t\t\tstage.destroyObject(col, row);\n\t\t\tstage.score += 200;\n\t\t\tplayAudio('crystal');\n\t\t\treturn;\n\t\t} else if (this.triggered > 0) {\n\t\t\t(this.triggered)--;\n\t\t} else {\n\t\t\tvar neighbour = stage.getNeighbour(col, row);\n\t\t\tvar len = neighbour.length;\n\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\tvar object = stage.getObject(neighbour[i].col, neighbour[i].row);\n\t\t\t\tif (undefined != object && object.type == this.type) {\n\t\t\t\t\tif (object.triggered == -1 || object.triggered == this.TRIGGER){\n\t\t\t\t\t\tthis.trigger();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tneighbour.splice(0, neighbour.length);\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tif (this.triggered > 0) {\n\t\t\tdrawImage(image[this.type][this.triggered % 3], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t}\n\t}\n}\nexport class Door{\n\ttype = 'Door';\n\tdestroy = true;\n\tonPick(player) {\n\t\tvar len = player.stage.data.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = player.stage.data[i];\n\t\t\tif (undefined == object) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tswitch (object.type){\n\t\t\t\tcase 'Key':\n\t\t\t\t\tobject.pick = true;\n\t\t\t\tbreak;\n\t\t\t\tcase 'Door':\n\t\t\t\t\tobject.pick = undefined;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class Egg{\n\ttype = 'Egg';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tvar len = player.stage.data.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = player.stage.data[i];\n\t\t\tif (undefined != object && 'Flower' == object.type) {\n\t\t\t\tobject.poisonous = !object.poisonous;\n\t\t\t}\n\t\t}\n\t\tplayer.stage.score += 100;\n\t}\n\tonDraw(ctx, col, row) {\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n\tblackArea(stage, col, row) {\n\t\treturn [{col:col, row: row}];\n\t}\n}\nexport class Flower{\n\ttype = 'Flower';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tconstructor(poisonous){\n\t\tthis.poisonous = poisonous;\n\t}\n\tonPick(player) {\n\t\tif (this.poisonous) {\n\t\t\tplayer.poisoned = true;\n\t\t} else {\n\t\t\tplayer.stage.score += 50;\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tif (this.poisonous) {\n\t\t\tdrawImage(image[this.type][1], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t}\n\t}\n\tblackArea(stage, col, row) {\n\t\tif (this.poisonous) {\n\t\t\treturn [{col:col, row: row}];\n\t\t}\n\t\treturn [];\n\t}\n}\nexport class Key{\n\ttype = 'Key';\n\tpick = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tvar len = player.stage.data.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = player.stage.data[i];\n\t\t\tif (undefined == object) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tswitch (object.type){\n\t\t\t\tcase 'Key':\n\t\t\t\t\tobject.pick = undefined;\n\t\t\t\tbreak;\n\t\t\t\tcase 'Door':\n\t\t\t\t\tobject.pick = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class LaserGun{\n\ttype = 'LaserGun';\n\tdestroy = true;\n\tdetectedPos = new Array();\n\tblackAreaDetected = new Array();\n\n\tdoDetect(stage, col, row) {\n\t\tlet result = new Array();\n\t\tthis.blackAreaDetected.splice(0, this.blackAreaDetected.length);\n\n\t\t//North\n\t\tfor (var __row = row - 1; __row >= 0; __row--) {\n\t\t\tvar object = stage.getObject(col, __row);\n\t\t\tthis.blackAreaDetected.push({col:col, row:__row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:col, row:__row, dir:DIR_NORTH});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//East\n\t\tfor (var __col = col + 1; __col < stage.cols; __col++) {\n\t\t\tvar object = stage.getObject(__col, row);\n\t\t\tthis.blackAreaDetected.push({col:__col, row:row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:__col, row:row, dir:DIR_EAST});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//West\n\t\tfor (var __col = col - 1; __col >= 0; __col--) {\n\t\t\tvar object = stage.getObject(__col, row);\n\t\t\tthis.blackAreaDetected.push({col:__col, row:row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:__col, row:row, dir:DIR_WEST});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//South\n\t\tfor (var __row = row + 1; __row < stage.rows; __row++) {\n\t\t\tvar object = stage.getObject(col, __row);\n\t\t\tthis.blackAreaDetected.push({col:col, row:__row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:col, row:__row, dir:DIR_SOUTH});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (result.length > 0 ? result : undefined);\n\t}\n\tsetupLaser(stage, col, row, posDetected){\n\t\tswitch (posDetected.dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\t\tfor (var y = row - 1; y > posDetected.row; y--) {\n\t\t\t\t\tstage.setObject(col, y, new SpacerLaser(DIR_NORTH));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tfor (var x = col + 1; x < posDetected.col; x++) {\n\t\t\t\t\tstage.setObject(x, row, new SpacerLaser(DIR_EAST));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tfor (var x = col - 1; x > posDetected.col; x--) {\n\t\t\t\t\tstage.setObject(x, row, new SpacerLaser(DIR_WEST));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tfor (var y = row + 1; y < posDetected.row; y++) {\n\t\t\t\t\tstage.setObject(col, y, new SpacerLaser(DIR_SOUTH));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tplayAudio('lasershot');\n\t}\n\tonTick(stage, col, row) {\n\t\tthis.detectedPos = this.doDetect(stage, col, row);\n\t\tif (undefined != this.detectedPos) {\n\t\t\tfor (var i = 0; i < this.detectedPos.length; i++) {\n\t\t\t\tvar pos = this.detectedPos[i];\n\t\t\t\tvar object = stage.getObject(pos.col, pos.row);\n\t\t\t\tif (undefined != object && 'SpacerPlayer' == object.type\n\t\t\t\t\t&& object.src.invisible <= 0\n\t\t\t\t\t&& !object.leaving && !object.src.Moveable.isMoving()) {\n\t\t\t\t\tstage.setObject(pos.col, pos.row,\n\t\t\t\t\t\tnew SpacerPlayerPoisoned(object.src));\n\t\t\t\t\tstage.destroyPlayer(object.src);\n\t\t\t\t\tthis.setupLaser(stage, col, row, pos);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.detectedPos.splice(0, this.detectedPos.length);\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n\tblackArea(stage, col, row) {\n\t\treturn this.blackAreaDetected;\n\t}\n}\nexport class Mushroom{\n\ttype = 'Mushroom';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tconstructor(poisonous){\n\t\tthis.poisonous = poisonous;\n\t}\n\tonPick(player) {\n\t\tif (this.poisonous) {\n\t\t\tplayer.poisoned = true;\n\t\t} else {\n\t\t\tplayer.stage.score += 500;\n\t\t\tplayer.finished = true;\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tif (this.poisonous) {\n\t\t\tdrawImage(image[this.type][1], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t}\n\t}\n\tblackArea(stage, col, row) {\n\t\tif (this.poisonous) {\n\t\t\treturn [{col:col, row:row}];\n\t\t}\n\t\treturn [];\n\t}\n}\nexport class PFlower{\n\ttype = 'PFlower';\n\teat = true;\n\tdestroy = true;\n\topen = 0;\n\tdigest = 0;\n\tgrab = {\n\t\ttype: undefined,\n\t\tdir: undefined,\n\t\ttimeout: 0,\n\t\tspacerCol: undefined,\n\t\tspacerRow: undefined,\n\t};\n\tconstructor(opened){\n\t\t/* Values of this.status:\n\t\t * 'C' : Flower closed\n\t\t * 'o' : Flower opening\n\t\t * 'O' : Flower opened\n\t\t * 'G' : Flower grabbing object\n\t\t * 'D' : Flower digesting\n\t\t */\n\t\tthis.status = (opened ? 'O' : 'C');\n\t}\n\tdoOpen(){\n\t\tif ('C' == this.status) {\n\t\t\tthis.open = image[this.type]['open'].length;\n\t\t\tthis.status = 'o';\n\t\t}\n\t}\n\tdoDigest(stage, col, row) {\n\t\tthis.status = 'D';\n\t\tstage.setObject(this.grab.spacerCol, this.grab.spacerRow, undefined);\n\t\tswitch (this.grab.type) {\n\t\t\tcase 'Player':\n\t\t\t\tthis.digest = -1;\n\t\t\tbreak;\n\t\t\tcase 'Apple':\n\t\t\t\tthis.digest = 160;\n\t\t\tbreak;\n\t\t\tcase 'AppleRotten':\n\t\t\t\tthis.digest = 1600;\n\t\t\tbreak;\n\t\t}\n\t}\n\tdoDetect(stage, col, row, type) {\n\t\tvar result = undefined;\n\t\t//Check whether a player is nearby\n\t\tvar neighbour = stage.getNeighbour(col, row);\n\t\tvar len = neighbour.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = stage.getObject(neighbour[i].col, neighbour[i].row);\n\t\t\tif (undefined != object && object.type == type){\n\t\t\t\tif (type == 'SpacerPlayer') {\n\t\t\t\t\tlet player = object.src;\n\t\t\t\t\tif (player.invisible <= 0) {\n\t\t\t\t\t\tresult = {\n\t\t\t\t\t\t\ttype: object.type,\n\t\t\t\t\t\t\tobject: object,\n\t\t\t\t\t\t\tcol: neighbour[i].col,\n\t\t\t\t\t\t\trow: neighbour[i].row,\n\t\t\t\t\t\t\tdir: neighbour[i].dir,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult = {\n\t\t\t\t\t\ttype: object.type,\n\t\t\t\t\t\tobject: object,\n\t\t\t\t\t\tcol: neighbour[i].col,\n\t\t\t\t\t\trow: neighbour[i].row,\n\t\t\t\t\t\tdir: neighbour[i].dir,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tneighbour.splice(0, neighbour.length);\n\t\treturn result;\n\t}\n\tdoGrab(stage, col, row, detected) {\n\t\tthis.status = 'G';\n\t\tstage.setObject(detected.col, detected.row, new SpacerPFlower(detected.dir, detected.type));\n\t\tthis.grab.type = detected.type;\n\t\tthis.grab.dir = detected.dir;\n\t\tthis.grab.spacerCol = detected.col;\n\t\tthis.grab.spacerRow = detected.row;\n\t\tthis.grab.timeout = 4;\n\t\tplayAudio('grab');\n\t}\n\tonTick(stage, col, row) {\n\t\tswitch (this.status) {\n\t\t\tcase 'C':\n\t\t\t\tvar detected = this.doDetect(stage, col, row, 'SpacerPlayer');\n\t\t\t\tif (undefined != detected && !detected.object.src.Moveable.isMoving()) {\n\t\t\t\t\tthis.doOpen();\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'o':\n\t\t\t\tthis.open--;\n\t\t\t\tif (this.open <= 0) {\n\t\t\t\t\tthis.status = 'O';\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'O':\n\t\t\t\tvar detected = undefined;\n\t\t\t\tdo {\n\t\t\t\t\tdetected = this.doDetect(stage, col, row, 'SpacerPlayer');\n\t\t\t\t\tif (undefined != detected\n\t\t\t\t\t\t&& !detected.object.leaving\n\t\t\t\t\t\t&& !detected.object.src.Moveable.isMoving()) {\n\t\t\t\t\t\tstage.destroyPlayer(detected.object.src);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdetected = this.doDetect(stage, col, row, 'Apple');\n\t\t\t\t\tif (undefined != detected) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdetected = this.doDetect(stage, col, row, 'AppleRotten');\n\t\t\t\t\tif (undefined != detected) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Nothing valuable detected\n\t\t\t\t\tdetected = undefined;\n\t\t\t\t}while(0);\n\t\t\t\tif (undefined != detected) {\n\t\t\t\t\tthis.doGrab(stage, col, row, detected);\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'G':\n\t\t\t\tthis.grab.timeout--;\n\t\t\t\tif (0 == this.grab.timeout) {\n\t\t\t\t\tthis.doDigest(stage, col, row);\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'D':\n\t\t\t\tif (this.digest > 0) {\n\t\t\t\t\tthis.digest--;\n\t\t\t\t\tif (0 == this.digest) {\n\t\t\t\t\t\tthis.status = 'C';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tvar img, frameCount, frameSpace, frame;\n\t\tswitch (this.status) {\n\t\t\tcase 'C':\n\t\t\t\timg = image[this.type]['digest'][0];\n\t\t\tbreak;\n\t\t\tcase 'o':\n\t\t\t\tframeCount = image[this.type]['open'].length;\n\t\t\t\tframe = (this.open >= 0 ? this.open : 0);\n\t\t\t\tframe = (frame < frameCount ? frame : frameCount - 1);\n\t\t\t\timg = image[this.type]['open'][frame];\n\t\t\tbreak;\n\t\t\tcase 'O':\n\t\t\t\timg = image[this.type]['open'][0];\n\t\t\tbreak;\n\t\t\tcase 'G':\n\t\t\t\timg = image[this.type]['grab'][this.grab.dir];\n\t\t\tbreak;\n\t\t\tcase 'D':\n\t\t\t\tframeCount = image[this.type]['digest'].length;\n\t\t\t\tswitch (this.grab.type) {\n\t\t\t\t\tcase 'Apple':\n\t\t\t\t\t\tframe = Math.ceil(this.digest / 40);\n\t\t\t\t\t\tframe = (frame < frameCount ? frame : frameCount - 1);\n\t\t\t\t\t\timg = image[this.type]['digest'][frame];\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'AppleRotten':\n\t\t\t\t\t\tframe = Math.ceil(this.digest / 400);\n\t\t\t\t\t\tframe = (frame < frameCount ? frame : frameCount - 1);\n\t\t\t\t\t\timg = image[this.type]['digest'][frame];\n\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tframe = Math.floor(Math.random() * 3);\n\t\t\t\t\t\timg = image[this.type]['player'][frame];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\t//Finally draw the image\n\t\tdrawImage(img, ctx, col, row);\n\t}\n\tblackArea(stage, col, row) {\n\t\tvar result = new Array();\n\t\tvar neighbour = stage.getNeighbour(col, row, undefined);\n\t\tfor (var i = 0; i < neighbour.length; i++) {\n\t\t\tresult.push({col:neighbour[i].col, row:neighbour[i].row});\n\t\t}\n\t\tresult.push({col:col, row: row});\n\t\tneighbour.splice(0, neighbour.length);\n\t\treturn result;\n\t}\n}\nexport class Pill {\n\ttype = 'Pill';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tplayer.invisible += 200;\n\t}\n\tonDraw(ctx, col, row) {\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class SpacerDemon{\n\ttype = 'SpacerDemon';\n\tdestroy = true;\n\tleaving = false;\n\tconstructor(src){\n\t\tthis.src = src;\n\t}\n\tonDestroy(stage, col, row) {\n\t\tif (!this.leaving) {\n\t\t\tvar demon = this.src;\n\t\t\tif (undefined != demon.Moveable.colPrev\n\t\t\t\t&& undefined != demon.Moveable.rowPrev) {\n\t\t\t\tstage.setObject(demon.Moveable.colPrev, demon.Moveable.rowPrev, undefined);\n\t\t\t}\n\t\t\tstage.destroyDemon(demon);\n\t\t}\n\t}\n\tonTick(stage, col, row){\n\t\tif (this.leaving) {\n\t\t\tthis.destroy = false;\n\t\t}\n\t}\n\t/*\n\tthis.onDraw = function (ctx, col, row) {\n\t\tif (this.leaving){\n\t\t\tdrawImage(image['AppleRotten'][0], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image['Apple'], ctx, col, row);\n\t\t}\n\t}\n\t*/\n}\nexport class SpacerLaser{\n\ttype = 'SpacerLaser';\n\ttimeout = 3;\n\tconstructor(dir){\n\t\tthis.dir=dir;\n\t}\n\tonTick(stage, col, row) {\n\t\tthis.timeout--;\n\t\tif (this.timeout <= 0) {\n\t\t\tstage.setObject(col, row, undefined);\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tvar img;\n\t\tswitch(this.dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tdrawImage(image[this.type][1], ctx, col, row);\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\tcase DIR_WEST:\n\t\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t\tbreak;\n\t\t}\n\t}\n}\nexport class SpacerObject{\n\ttype = 'SpacerObject';\n\tconstructor(src){\n\t\tthis.src = src;\n\t}\n}\nexport class SpacerPFlower{\n\ttype = 'SpacerPFlower';\n\ttimeout = 24;\n\tconstructor(dir, type){\n\t\tthis.dir = dir;\n\t\tthis.typeGrabbed = type;\n\t}\n\tonTick(stage, col, row) {\n\t\tthis.timeout--;\n\t\tif (this.timeout <= 0) {\n\t\t\tstage.setObject(col, row, undefined);\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tlet img;\n\t\tswitch (this.typeGrabbed) {\n\t\t\tcase 'SpacerPlayer':\n\t\t\t\timg = image[this.type]['grabPlayer'][this.dir];\n\t\t\tbreak;\n\t\t\tcase 'Apple':\n\t\t\tcase 'AppleRotten':\n\t\t\t\timg = image[this.type]['grabApple'][this.dir];\n\t\t\tbreak;\n\t\t}\n\t\tdrawImage(img, ctx, col, row);\n\t}\n}\nexport class SpacerPlayer{\n\ttype = 'SpacerPlayer';\n\teat = true;\n\tdestroy = true;\n\tleaving = false;\n\tconstructor(src){\n\t\tthis.src = src;\n\t}\n\tonEat(demon, stage, col, row) {\n\t\tif (!this.leaving) {\n\t\t\tif(!this.src.poisoned){\n\t\t\t\tplayAudio('bitten');\n\t\t\t}\n\t\t\tthis.src.poisoned = true;\n\t\t}\n\t}\n\tonDestroy(stage, col, row) {\n\t\tvar player = this.src;\n\t\tif (undefined != player.Moveable.colPrev\n\t\t\t&& undefined != player.Moveable.rowPrev) {\n\t\t\tstage.setObject(player.Moveable.colPrev, player.Moveable.rowPrev, undefined);\n\t\t}\n\t\tstage.destroyPlayer(player);\n\t}\n\tonTick(stage, col, row){\n\t\tif (this.leaving) {\n\t\t\tthis.destroy = this.eat = false;\n\t\t} else {\n\t\t\tthis.destroy = this.eat = true;\n\t\t}\n\t}\n}\nexport class SpacerPlayerPoisoned{\n\ttype = 'SpacerPlayerPoisoned';\n\ttimeout = 30;\n\tconstructor(player){\n\t\tthis.player=player;\n\t\tthis.dir = player.Moveable.dir;\n\t}\n\tonTick(stage, col, row) {\n\t\tif (0 == this.timeout) {\n\t\t\tstage.destroyObject(col, row);\n\t\t\treturn;\n\t\t}\n\t\tthis.timeout--;\n\t}\n\tonDraw(ctx, col, row){\n\t\tvar __type = (this.player.girl ? 'PlayerGirl' : 'Player');\n\t\tif (this.timeout > 20) {\n\t\t\tdrawImage(image[__type][this.dir][0], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[__type]['poisoned'][this.timeout > 12 ? 12 : this.timeout], ctx, col, row);\n\t\t}\n\n\t\tif (20 == this.timeout) {\n\t\t\tplayAudio('poisoned');\n\t\t}\n\t}\n}\nexport class Treasure{\n\ttype = 'Treasure';\n\tpick = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tplayer.stage.score += 1000;\n\t}\n\tonDraw(ctx, col, row) {\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class Wall{\n\ttype = 'Wall';\n\tconstructor(style){\n\t\tthis.style=style;\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type][this.style], ctx, col, row);\n\t}\n}\n","import {image,drawImage} from './image';\nimport {switchDir,Moveable} from './misc';\nimport { SpacerDemon } from './object';\n\nexport function leftFirst(demon) {\n\tvar dir = demon.Moveable.dir;\n\treturn [\n\t\tdir,\n\t\tswitchDir(dir, DIR_LEFT),\n\t\tswitchDir(dir, DIR_RIGHT),\n\t\tswitchDir(dir, DIR_BACK),\n\t];\n}\nexport function rightFirst(demon) {\n\tvar dir = demon.Moveable.dir;\n\treturn [\n\t\tdir,\n\t\tswitchDir(dir, DIR_RIGHT),\n\t\tswitchDir(dir, DIR_LEFT),\n\t\tswitchDir(dir, DIR_BACK),\n\t];\n}\nexport function randomSelection(demon) {\n\tvar dir = demon.Moveable.dir;\n\tif (Math.random() >= 0.5) {\n\t\treturn [\n\t\t\tdir,\n\t\t\tswitchDir(dir, DIR_LEFT),\n\t\t\tswitchDir(dir, DIR_RIGHT),\n\t\t\tswitchDir(dir, DIR_BACK),\n\t\t];\n\t} else {\n\t\treturn [\n\t\t\tdir,\n\t\t\tswitchDir(dir, DIR_RIGHT),\n\t\t\tswitchDir(dir, DIR_LEFT),\n\t\t\tswitchDir(dir, DIR_BACK),\n\t\t];\n\t}\n}\nexport function randomTurn(demon) {\n\tvar result = [DIR_NORTH, DIR_EAST, DIR_WEST, DIR_SOUTH];\n\tfor (var i = 1; i < result.length; i++) {\n\t\tvar irand = Math.floor(Math.random() * (i + 1));\n\t\tvar temp = result[irand];\n\t\tresult[irand] = result[i];\n\t\tresult[i] = temp;\n\t}\n\treturn result;\n}\nexport default class Demon{\n\ttype = 'Demon';\n\tturning = leftFirst;\n\tconstructor(stage, col, row, initDir){\n\t\tthis.Moveable = new Moveable(col, row, initDir);\n\t\tthis.stage = stage;\n\t\tthis.stage.setObject(col, row, new SpacerDemon(this));\n\t\tthis.dir = initDir;\n\t}\n\tmove(dir){\n\t\t//Demon is already moving\n\t\tif (this.Moveable.step > 0) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t//Change the direction of the demon\n\t\tthis.Moveable.dir = dir;\n\n\t\t//Finally move the daemon\n\t\tthis.Moveable.move(dir);\n\t\tthis.stage.setObject(this.Moveable.col, this.Moveable.row, new SpacerDemon(this));\n\t\tthis.stage.getObject(this.Moveable.colPrev, this.Moveable.rowPrev).leaving = true;\n\t\treturn true;\n\t}\n\tonTick(stage) {\n\t\tif (this.Moveable.isMoving()){\n\t\t\tvar result = this.Moveable.onTick();\n\t\t\tthis.dir = this.Moveable.dir;\n\t\t\tif (undefined != result) {\t//Demon has just finished moving\n\t\t\t\tthis.stage.setObject(result.colPrev, result.rowPrev, undefined);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tlet dirArray = this.turning(this), surrounded=true;\n\n\t\t//If a demon is surrended by objects, then check whether the object in front of the demon is eatable\n\t\tfor(let dir of dirArray){\n\t\t\tlet pos = stage.getNeighbour(this.Moveable.col, this.Moveable.row, dir);\n\t\t\tif (undefined == pos) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet object = stage.getObject(pos.col, pos.row);\n\t\t\tif(!object){\n\t\t\t\tsurrounded=false;\n\t\t\t}\n\t\t}\n\t\tif(surrounded){\n\t\t\t//Get the object in front\n\t\t\tlet pos = stage.getNeighbour(this.Moveable.col, this.Moveable.row, this.dir);\n\t\t\tif(!pos){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet object = stage.getObject(pos.col, pos.row);\n\t\t\tif(object && !/Spacer.*/.test(object.type) && object.eat){\n\t\t\t\t//Execute trigger onEat()\n\t\t\t\tobject.onEat && object.onEat(this, stage, pos.col, pos.row);\n\t\t\t\t//Destroy the object!!!\n\t\t\t\tstage.destroyObject(pos.col, pos.row);\n\t\t\t\tif (this.move(this.dir)) {\n\t\t\t\t\tthis.Moveable.step--;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tfor (var i in dirArray) {\n\t\t\tthis.dir = dirArray[i];\n\t\t\tvar pos = stage.getNeighbour(this.Moveable.col, this.Moveable.row, dirArray[i]);\n\t\t\t//Edge reached\n\t\t\tif (undefined == pos) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar object = stage.getObject(pos.col, pos.row);\n\t\t\tif (undefined != object) {\n\t\t\t\t//If a spacer is in front, the demon will stop until the spacer disappears, Except demon\n\t\t\t\tif (/Spacer.*/.test(object.type)) {\n\t\t\t\t\t//Execute trigger onEat()\n\t\t\t\t\tif (true == object.eat && undefined != object.onEat) {\n\t\t\t\t\t\tobject.onEat(this, stage, pos.col, pos.row);\n\t\t\t\t\t}\n\t\t\t\t\tif (object.type != 'SpacerDemon') {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//The object detected is not eatable\n\t\t\t\tif (true != object.eat) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t//Execute trigger onEat()\n\t\t\t\tif (undefined != object.onEat) {\n\t\t\t\t\tobject.onEat(this, stage, pos.col, pos.row);\n\t\t\t\t}\n\t\t\t\t//Destroy the object!!!\n\t\t\t\tstage.destroyObject(pos.col, pos.row);\n\t\t\t}\n\t\t\tif (this.move(dirArray[i])) {\n\t\t\t\tthis.Moveable.step--;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx) {\n\t\tvar idx_img = [0, 1, 0, 2, 0, 1, 0, 2, 0];\n\t\tvar img = image[this.type][this.dir][idx_img[this.Moveable.step]];\n\t\tthis.Moveable.onDraw(img, ctx);\n\t}\n}\n\n","import Level from './level';\nimport Stage from './stage';\nimport Demon from './demon';\nimport {\n\tleftFirst,\n\trightFirst,\n\trandomSelection,\n\trandomTurn\n} from './demon';\nimport Player from './player';\nimport {\n\tApple,\n\tAppleRotten,\n\tBall,\n\tBomb,\n\tCrystal,\n\tDoor,\n\tEgg,\n\tFlower,\n\tKey,\n\tLaserGun,\n\tMushroom,\n\tPFlower,\n\tPill,\n\tTreasure,\n\tWall\n} from './object';\nimport {\n\tDIR_NORTH,\n\tDIR_EAST,\n\tDIR_WEST,\n\tDIR_SOUTH,\n\tDIR_LEFT,\n\tDIR_RIGHT,\n\tDIR_BACK,\n} from './misc';\nimport{\n\tIMAGE_W,\n\tIMAGE_H,\n} from './image';\n\nObject.assign(window,{\n\tStage,\n\tPlayer,\n\tDemon,\n\tApple,\n\tAppleRotten,\n\tBall,\n\tBomb,\n\tCrystal,\n\tDoor,\n\tEgg,\n\tFlower,\n\tKey,\n\tLaserGun,\n\tMushroom,\n\tPFlower,\n\tPill,\n\tTreasure,\n\tWall,\n\tIMAGE_W,\n\tIMAGE_H,\n\tDIR_NORTH,\n\tDIR_EAST,\n\tDIR_WEST,\n\tDIR_SOUTH,\n\tDIR_LEFT,\n\tDIR_RIGHT,\n\tDIR_BACK,\n\tleftFirst,\n\trightFirst,\n\trandomSelection,\n\trandomTurn,\n});\n\nfunction puzzlePackFinished(packName, totalScore){\n\tdocument.querySelector('canvas#stage').style.display='none';\n\tdocument.querySelector('div#footer').style.display='none';\n\tdocument.querySelector('div#gamefinished').style.display='block';\n\tdocument.querySelector('div#gamefinished h1#totalscore').innerHTML=totalScore;\n\t//Replay puzzle pack\n\ttry{\n\t\tlet storageData=localStorage.getItem('puzzleProcess');\n\t\tif(storageData){\n\t\t\tstorageData=JSON.parse(storageData);\n\t\t\tdelete storageData[packName + '_Level'];\n\t\t\tdelete storageData[packName + '_Score'];\n\t\t\tlocalStorage.setItem('puzzleProcess',JSON.stringify(storageData));\n\t\t}\n\t}catch(e){\n\t\tconsole.error(e);\n\t}\n}\nexport default function(packName, levelData) {\n\tvar ctx = document.querySelector('canvas#stage').getContext('2d');\n\tvar totalScore = 0;\n\tvar levelNum = 0;\n\n\t//Disable sound by default\n\tdocument.querySelector('input#enableSound').checked = false;\n\tdocument.querySelector('input#enableSound').addEventListener('change',(e)=>{\n\t\tlet settingData=localStorage.getItem('gameSetting');\n\t\tsettingData = settingData ? JSON.parse(settingData) : {};\n\t\tsettingData.soundOn=e.target.checked;\n\t\tlocalStorage.setItem('gameSetting',JSON.stringify(settingData));\n\t\te.target.blur();\n\t});\n\n\t//Read sound on/off from localStorage\n\ttry{\n\t\tlet settingData=localStorage.getItem('gameSetting');\n\t\tif(settingData){\n\t\t\tsettingData=JSON.parse(settingData);\n\t\t\tdocument.querySelector('input#enableSound').checked = settingData.soundOn;\n\t\t}\n\t}catch(e){\n\t\tconsole.error(e);\n\t}\n\n\t//Get puzzle pack stored data\n\ttry{\n\t\tlet storageData=localStorage.getItem('puzzleProcess');\n\t\tif(storageData){\n\t\t\tstorageData=JSON.parse(storageData);\n\t\t\ttotalScore=storageData[packName + '_Score'] || undefined;\n\t\t\tlevelNum=storageData[packName + '_Level'] || undefined;\n\t\t}\n\t}catch(e){\n\t\tconsole.error(e);\n\t}\n\tif (undefined != totalScore && !isNaN(totalScore)) {\n\t\ttotalScore = Number(totalScore);\n\t}\n\tif (undefined != levelNum && !isNaN(levelNum)) {\n\t\tlevelNum = Number(levelNum);\n\t} else {\n\t\tlevelNum = totalScore = 0;\n\t}\n\n\t//Game already finished\n\tif (levelNum >= levelData.length) {\n\t\tpuzzlePackFinished(packName, totalScore);\n\t\treturn;\n\t} \n\n\t//Start game\n\tvar level = new Level(levelData[levelNum], ctx);\n\tdocument.querySelector('span#level').innerHTML=(levelNum + 1);\n\n\t//Populate level selector\n\tconst levelSelect = document.querySelector('select#levelSelect');\n\tlevelSelect.innerHTML = '';\n\tconst totalLevels = levelData.length;\n\tfor (let i = 0; i < totalLevels; i++) {\n\t\tconst option = document.createElement('option');\n\t\toption.value = i;\n\t\toption.text = 'Level ' + (i + 1) + ' of ' + totalLevels;\n\t\tlevelSelect.appendChild(option);\n\t}\n\tlevelSelect.value = levelNum;\n\n\t//Jump to level function\n\tconst jumpToLevel = function(newLevelNum) {\n\t\tif (newLevelNum >= 0 && newLevelNum < levelData.length) {\n\t\t\tlevelNum = newLevelNum;\n\t\t\ttotalScore = 0;\n\t\t\ttry {\n\t\t\t\tlet storageData = localStorage.getItem('puzzleProcess');\n\t\t\t\tif (storageData) {\n\t\t\t\t\tstorageData = JSON.parse(storageData);\n\t\t\t\t} else {\n\t\t\t\t\tstorageData = {};\n\t\t\t\t}\n\t\t\t\tstorageData[packName + '_Level'] = levelNum;\n\t\t\t\tstorageData[packName + '_Score'] = totalScore;\n\t\t\t\tlocalStorage.setItem('puzzleProcess', JSON.stringify(storageData));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t\tif (level) {\n\t\t\t\tlevel.stop();\n\t\t\t}\n\t\t\tlevel = new Level(levelData[levelNum], ctx);\n\t\t\tlevel.onFinish(onFinish);\n\t\t\tdocument.querySelector('span#level').innerHTML = (levelNum + 1);\n\t\t\tdocument.querySelector('span#score').innerHTML = totalScore;\n\t\t}\n\t};\n\n\t//Level selector change event\n\tlevelSelect.addEventListener('change', (e) => {\n\t\tconst selectedLevel = parseInt(e.target.value, 10);\n\t\tjumpToLevel(selectedLevel);\n\t\te.target.blur();\n\t});\n\n\tconst onFinish=function(levelScore){\n\t\ttotalScore += levelScore;\n\t\tlevelNum++;\n\t\ttry{\n\t\t\tlet storageData=localStorage.getItem('puzzleProcess');\n\t\t\tif(storageData){\n\t\t\t\tstorageData=JSON.parse(storageData);\n\t\t\t}else{\n\t\t\t\tstorageData={};\n\t\t\t}\n\t\t\tstorageData[packName + '_Level']=levelNum;\n\t\t\tstorageData[packName + '_Score']=totalScore;\n\t\t\tlocalStorage.setItem('puzzleProcess',JSON.stringify(storageData));\n\t\t}catch(e){\n\t\t\tconsole.error(e);\n\t\t}\n\t\tif (levelNum < levelData.length) {\n\t\t\t//Next level\n\t\t\tlevel = new Level(levelData[levelNum], ctx);\n\t\t\tlevel.onFinish(onFinish);\n\t\t\tdocument.querySelector('span#level').innerHTML=(levelNum + 1);\n\t\t\tlevelSelect.value = levelNum;\n\t\t} else {\n\t\t\t//Game finished\n\t\t\tlevel = undefined;\n\t\t\tpuzzlePackFinished(packName, totalScore);\n\t\t}\n\t}\n\tlevel.onFinish(onFinish);\n}\n","import {image,drawImage} from './image';\nexport default class Stage{\n\tname = '';\n\tcols = 17;\n\trows = 12;\n\n\tdata = new Array(17 * 12);\n\tplayer = new Array();\n\tdemon = new Array();\n\n\tposDestroyed = new Array();\n\tfinished = false;\n\tscore = 0;\n\n\tconstructor(initfunc){\n\t\t//Init the stage\n\t\tif (undefined != initfunc) {\n\t\t\tthis.initfunc=initfunc;\n\t\t\tinitfunc(this);\n\t\t}\n\t}\n\n\tgetObject(col, row){\n\t\treturn this.data[row * this.cols + col];\n\t}\n\tsetObject(col, row, object){\n\t\tdelete this.data[row * this.cols + col];\n\t\tthis.data[row * this.cols + col] = object;\n\t}\n\tdestroyObject(col, row){\n\t\tvar object = this.getObject(col, row);\n\t\tif (undefined != object) {\n\t\t\tif (undefined != object.onDestroy) {\n\t\t\t\tobject.onDestroy(this, col, row);\n\t\t\t}\n\t\t\tthis.posDestroyed.push([col, row]);\n\t\t\tthis.setObject(col, row, undefined);\n\t\t}\n\t}\n\tdestroyPlayer(playerObj) {\n\t\tthis.player[this.player.indexOf(playerObj)] = null;\n\t\tthis.player[this.player.indexOf(playerObj)] = undefined;\n\t\tplayerObj = null;\n\t}\n\tdestroyDemon(demonObj) {\n\t\tthis.demon[this.demon.indexOf(demonObj)] = null;\n\t\tthis.demon[this.demon.indexOf(demonObj)] = undefined;\n\t\tdemonObj = null;\n\t}\n\n\tgetNeighbour(col, row, dir) {\n\t\tswitch (dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\t\tif (row > 0) {\n\t\t\t\t\treturn {col:col, row:(row - 1)};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tif (col < (this.cols - 1)) {\n\t\t\t\t\treturn {col:(col + 1), row:row};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tif (col > 0) {\n\t\t\t\t\treturn {col:(col - 1), row:row};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tif (row < (this.rows - 1)) {\n\t\t\t\t\treturn {col:col, row:(row + 1)};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvar result = new Array();\n\t\t\t\t//North\n\t\t\t\tif (row > 0) {\n\t\t\t\t\tresult.push({col:col, row:(row - 1), dir:DIR_NORTH});\n\t\t\t\t}\n\t\t\t\t//East\n\t\t\t\tif (col < (this.cols - 1)) {\n\t\t\t\t\tresult.push({col:(col + 1), row:row, dir:DIR_EAST});\n\t\t\t\t}\n\t\t\t\t//West\n\t\t\t\tif (col > 0) {\n\t\t\t\t\tresult.push({col:(col - 1), row:row, dir:DIR_WEST});\n\t\t\t\t}\n\t\t\t\t//South\n\t\t\t\tif (row < (this.rows - 1)) {\n\t\t\t\t\tresult.push({col:col, row:(row + 1), dir:DIR_SOUTH});\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\ttick(ctx) {\n\t\t//Players\n\t\tvar len = this.player.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.player[i]) {\n\t\t\t\tthis.player[i].onTick(this);\n\t\t\t}\n\t\t}\n\n\t\t//Demons\n\t\tvar len = this.demon.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.demon[i]) {\n\t\t\t\tthis.demon[i].onTick(this);\n\t\t\t}\n\t\t}\n\n\t\t//Objects on the stage\n\t\tfor (var row = 0; row < this.rows; row++) {\n\t\t\tfor (var col = 0; col < this.cols; col++) {\n\t\t\t\tlet object = this.data[row * this.cols + col];\n\t\t\t\tif (undefined != object && undefined != object.onTick) {\n\t\t\t\t\tobject.onTick(this, col, row);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tdraw(ctx) {\n\t\t//Draw objects on the stage\n\t\tfor (var row = 0; row < this.rows; row++) {\n\t\t\tfor (var col = 0; col < this.cols; col++) {\n\t\t\t\tlet object = this.data[row * this.cols + col];\n\t\t\t\tif (undefined == object || undefined == object.onDraw) {\n\t\t\t\t\tdrawImage(image[undefined], ctx, col, row);\n\t\t\t\t} else {\n\t\t\t\t\tobject.onDraw(ctx, col, row);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Draw destroyed objects\n\t\tvar len = this.posDestroyed.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tcol = this.posDestroyed[i][0];\n\t\t\trow = this.posDestroyed[i][1];\n\t\t\tdrawImage(image['Destroyed'], ctx, col, row);\n\t\t}\n\t\tdelete this.posDestoryed;\n\t\tthis.posDestroyed = [];\n\n\t\t//Draw player and demon\n\t\tvar len = this.demon.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.demon[i]) {\n\t\t\t\tthis.demon[i].onDraw(ctx);\n\t\t\t}\n\t\t}\n\t\tvar len = this.player.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.player[i]) {\n\t\t\t\tthis.player[i].onDraw(ctx);\n\t\t\t}\n\t\t}\n\t}\n\treset(){\n\t\tdelete this.data;\n\t\tdelete this.player;\n\t\tdelete this.demon;\n\t\tdelete this.posDestoryed;\n\t\tthis.data = new Array(this.rows * this.cols);\n\t\tthis.player = new Array();\n\t\tthis.demon = new Array();\n\t\tthis.posDestroyed = new Array();\n\t\tthis.finished = false;\n\t\tthis.score = 0;\n\t\tif (undefined != this.initfunc) {\n\t\t\tthis.initfunc(this);\n\t\t}\n\t}\n}\n\n","import {image,drawImage} from './image';\nimport { playAudio,Moveable } from \"./misc\";\nimport { SpacerPlayer, SpacerObject, SpacerPlayerPoisoned } from \"./object\";\n\nexport default class Player{\n\ttype = 'Player';\n\tfinished = false;\n\tpoisoned = false;\n\tobjectPushing = undefined;\n\tinvisible = 0;\n\tsleepy = 0;\n\tconstructor(stage, col, row, isGirl){\n\t\tthis.Moveable = new Moveable(col, row, DIR_SOUTH);\n\t\tthis.girl = isGirl;\n\t\tthis.stage = stage;\n\t\tthis.stage.setObject(col, row, new SpacerPlayer(this));\n\t}\n\tonTick(stage) {\n\t\tvar result = this.Moveable.onTick();\n\t\tif (undefined != result) {\t//Player has just finished moving\n\t\t\tthis.stage.setObject(result.colPrev, result.rowPrev, undefined);\n\t\t\tif (undefined != this.objectPushing) {\n\t\t\t\tvar objectPos = this.stage.getNeighbour(\n\t\t\t\t\tthis.Moveable.col, this.Moveable.row, this.Moveable.dir);\n\t\t\t\tthis.stage.setObject(objectPos.col, objectPos.row , this.objectPushing);\n\t\t\t\tthis.objectPushing = undefined;\n\t\t\t}\n\t\t}\n\t\tif (undefined != result || !this.Moveable.isMoving()) {\n\t\t\t//Player is poisoned\n\t\t\tif (this.poisoned == true) {\n\t\t\t\tthis.stage.setObject(this.Moveable.col, this.Moveable.row,\n\t\t\t\t\tnew SpacerPlayerPoisoned(this));\n\t\t\t\tthis.stage.destroyPlayer(this);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//Player finished\n\t\t\tif (this.finished) {\n\t\t\t\tthis.stage.finished = true;\n\t\t\t}\n\t\t}\n\n\t\tif (undefined != this.objectPushing\n\t\t\t&& undefined != this.objectPushing.onTick) {\n\t\t\tthis.objectPushing.onTick(this.stage, -1, -1);\n\t\t}\n\n\t\t//Other thigs\n\t\tif (this.invisible > 0) {\n\t\t\tthis.invisible--;\n\t\t}\n\t}\n\tmove(dir){\n\t\t//Player is moving\n\t\tif (this.Moveable.step > 0) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t//Change the direction of the player\n\t\tthis.Moveable.dir = dir;\n\n\t\t//Test whether the edge is in front of the player.\n\t\tvar nextPos = this.stage.getNeighbour(this.Moveable.col, this.Moveable.row, dir);\n\t\tif (undefined == nextPos) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Test the object in front of the player.\n\t\tvar nextPosObject = this.stage.getObject(nextPos.col, nextPos.row);\n\t\tif (nextPosObject != undefined){\n\t\t\tif (nextPosObject.pick == true){\n\t\t\t\tif (undefined != nextPosObject.onPick) {\n\t\t\t\t\tnextPosObject.onPick(this);\n\t\t\t\t}\n\t\t\t\tthis.stage.destroyObject(nextPos.col, nextPos.row);\n\t\t\t\tplayAudio('pick');\n\t\t\t} else if (nextPosObject.push == true) {\n\t\t\t\tlet nextPos2 = this.stage.getNeighbour(nextPos.col, nextPos.row, dir);\n\t\t\t\tif (undefined == nextPos2\n\t\t\t\t\t|| undefined != this.stage.getObject(nextPos2.col, nextPos2.row)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis.objectPushing = nextPosObject;\n\t\t\t\tthis.stage.setObject(nextPos2.col, nextPos2.row, new SpacerObject(nextPosObject));\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t//Finally move the player\n\t\tthis.Moveable.move(dir);\n\t\tthis.stage.setObject(this.Moveable.col, this.Moveable.row, new SpacerPlayer(this));\n\t\tthis.stage.getObject(this.Moveable.colPrev, this.Moveable.rowPrev).leaving = true;\n\t\treturn true;\n\t}\n\tonDrawMoving(ctx) {\n\t\tvar idx_img = [0, 1, 0, 2, 0, 1, 0, 2];\n\t\tvar __type = (this.girl ? this.type + 'Girl' : this.type);\n\t\tvar img = (this.invisible > 0 ? image[undefined]\n\t\t\t: image[__type][this.Moveable.dir][idx_img[this.Moveable.step]]);\n\t\tthis.Moveable.onDraw(img, ctx);\n\t\tif (this.Moveable.step % 2) {\n\t\t\tplayAudio('step');\n\t\t}\n\n\t\t//Draw the object player is pushing\n\t\tif (undefined != this.objectPushing) {\n\t\t\tvar _col, _row;\n\t\t\tswitch (this.Moveable.dir){\n\t\t\t\tcase DIR_NORTH:\n\t\t\t\t\t_col = this.Moveable.col;\n\t\t\t\t\t_row = this.Moveable.row - 1 + this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\tbreak;\n\t\t\t\tcase DIR_EAST:\n\t\t\t\t\t_col = this.Moveable.col + 1 - this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\t\t_row = this.Moveable.row;\n\t\t\t\tbreak;\n\t\t\t\tcase DIR_WEST:\n\t\t\t\t\t_col = this.Moveable.col - 1 + this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\t\t_row = this.Moveable.row;\n\t\t\t\tbreak;\n\t\t\t\tcase DIR_SOUTH:\n\t\t\t\t\t_col = this.Moveable.col;\n\t\t\t\t\t_row = this.Moveable.row + 1 - this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.objectPushing.onDraw(ctx, _col, _row);\n\t\t}\n\t}\n\tonDrawSleepy(ctx) {\n\t\tif (this.invisible > 0) {\n\t\t\tthis.Moveable.onDraw(image[undefined], ctx);\n\t\t\treturn;\n\t\t}\n\n\t\tvar img;\n\t\tvar __type = (this.girl ? this.type + 'Girl' : this.type);\n\t\tif (this.sleepy < 50) {\n\t\t\tthis.onDrawMoving(ctx);\n\t\t\treturn;\n\t\t} else if (this.sleepy < 100) {\n\t\t\timg = image[__type]['sleepy'][0];\n\t\t} else if (this.sleepy < 300) {\n\t\t\timg = image[__type]['sleepy'][this.sleepy % 50 ? 0 : 1];\n\t\t} else if (this.sleepy < 400) {\n\t\t\timg = image[__type]['sleepy'][this.sleepy % 50 ? 2 : 3];\n\t\t} else {\n\t\t\timg = image[__type]['sleepy'][4];\n\t\t}\n\t\tthis.Moveable.onDraw(img, ctx);\n\t}\n\tonDraw(ctx) {\n\t\tif (this.Moveable.isMoving()) {\n\t\t\tthis.sleepy = 0;\n\t\t\tthis.onDrawMoving(ctx);\n\t\t} else {\n\t\t\tthis.sleepy++;\n\t\t\tthis.onDrawSleepy(ctx);\n\t\t}\n\t}\n}\n\n"],"names":["Maze","SPACE","undefined","WALL","FOOTPRINT","goal","footPrint","Array","constructor","w","h","initfunc","this","data","get","x","y","set","element","getDir","x0","y0","x1","y1","dx","dy","reachable","getPosByDir","dir","result","next","length","currentPos","dirCandidate","i","nextPos","push","pop","IMAGE_W","IMAGE_H","drawImage","__image","ctx","col","row","img","Math","floor","imageObj","Image","src","image","Apple","AppleRotten","Ball","Bomb","normal","ticking","detonate","Crystal","Demon","N","E","W","S","Destroyed","Door","Egg","Flower","Key","LaserGun","Mushroom","Player","sleepy","poisoned","PlayerGirl","PFlower","digest","open","player","grab","Pill","SpacerLaser","SpacerPFlower","grabApple","grabPlayer","Treasure","Wall","DIR_NORTH","DIR_EAST","DIR_WEST","DIR_SOUTH","switchDir","sw","expr","L","R","B","TypeError","col0","row0","col1","row1","Moveable","stepMax","colPrev","rowPrev","step","isMoving","move","onTick","onDraw","audioContext","AudioContext","audioTable","bitten","crystal","lasershot","pick","playAudio","audioFile","document","querySelector","checked","source","createBufferSource","buffer","loop","connect","destination","start","getDirFromRoute","playerRoute","nextDir","splice","solved","stage","destCol","destRow","maze","cols","rows","object","getObject","blackArea","posList","resultRaw","mazeSolver","async","fileList","taskList","fileName","task","Promise","resolve","resp","fetch","ok","console","error","statusText","decodeAudioData","arrayBuffer","respAll","all","map","item","forEach","idx","loadSound","Object","keys","then","Level","score","speed","paused","stopped","dirKeyPressed","playerRouteInUse","addEventListener","keydownHandler","keyupHandler","mousedownHandler","setTimeout","timeoutFunc","onFinish","func","_onFinish","stop","removeEventListener","callOnFinish","style","display","tick","draw","innerHTML","finished","reset","e","event","keyCode","xpos","offsetX","ypos","offsetY","shiftKey","SpacerDemon","type","destroy","leaving","onDestroy","demon","setObject","destroyDemon","timeout","SpacerObject","typeGrabbed","SpacerPlayer","eat","onEat","destroyPlayer","SpacerPlayerPoisoned","destroyObject","__type","girl","leftFirst","DIR_LEFT","DIR_RIGHT","DIR_BACK","puzzlePackFinished","packName","totalScore","storageData","localStorage","getItem","JSON","parse","setItem","stringify","assign","window","Stage","name","posDestroyed","playerObj","indexOf","demonObj","getNeighbour","len","posDestoryed","objectPushing","invisible","isGirl","objectPos","nextPosObject","onPick","nextPos2","onDrawMoving","_col","_row","onDrawSleepy","turning","initDir","dirArray","surrounded","pos","test","timer","img_index","detonated","doActivate","doDetonate","neighbour","ncol","nrow","moving","triggered","TRIGGER","trigger","poisonous","detectedPos","blackAreaDetected","doDetect","__row","__col","setupLaser","posDetected","spacerCol","spacerRow","opened","status","doOpen","doDigest","doGrab","detected","frameCount","frame","ceil","random","rightFirst","randomSelection","randomTurn","irand","temp","levelData","getContext","levelNum","settingData","soundOn","target","blur","isNaN","Number","level","levelSelect","totalLevels","option","createElement","value","text","appendChild","newLevelNum","jumpToLevel","parseInt","levelScore"],"mappings":"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"}